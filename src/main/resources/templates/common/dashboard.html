<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>

    <!-- Bootstrap & FontAwesome -->
    <link rel="stylesheet" href="/css/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="/css/common/all.min.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="/css/common/common.css">
    <script src="/js/jquery-3.7.1.min.js"></script>
    <!-- Google Fonts -->

<!--    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">-->
</head>
<body>

<!-- ğŸ”¹ ì „ì²´ ë ˆì´ì•„ì›ƒ -->
<div class="container-fluid">
    <!-- ğŸ”¹ ì‚¬ì´ë“œë°” -->
    <div th:replace="common/sidebar :: sidebar"></div>

    <!-- ğŸ”¹ ë©”ì¸ ì½˜í…ì¸  -->
    <div class="content">
        <!-- Header -->
        <div th:replace="common/header :: navbar"></div>

        <iframe id="dynamicFrame" class="col-md-12" src="/kisedorkr"></iframe>
    </div>
</div>

<!-- ğŸ”¹ JavaScript -->
<script>
    $(document).ready(function() {
        $(document).on("click", function (event) {
            const isMenuButton = $(event.target).closest(".p-menu").length > 0;
            const isSubmenu = $(event.target).closest(".submenu").length > 0;

            if (!isMenuButton && !isSubmenu) {
                $(".submenu").removeClass("show");
            }
        });

        window.addEventListener("blur", function () {
            const activeEl = document.activeElement;

            // í¬ì»¤ìŠ¤ë¥¼ ë°›ì€ ìš”ì†Œê°€ iframeì¼ ë•Œë§Œ ì²˜ë¦¬
            if (activeEl && activeEl.tagName === "IFRAME") {
                $(".submenu").removeClass("show");
            }
        });
    })

    function logout() {
        if(!confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        //csrf í† í°ì´ ìˆì–´ì•¼ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ. -> ì¶”í›„ ë§Œë“¤ê¸°
        fetch('/logout', {
            method: 'POST',
            credentials: 'same-origin' // CSRF ë³´í˜¸ í™œì„±í™” ì‹œ í•„ìš”
        })
            .then(response => {
                if (response.ok) {
                    return response;
                } else {
                    throw new Error('Logout failed');
                }
            })
            .then(data => {
                window.location.href = '/loginForm'; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    function toggleSubmenu(menuId, element) {
        const submenu = document.getElementById(menuId);
        const allSubmenus = document.querySelectorAll(".submenu");

        const isAlreadyVisible = submenu.classList.contains("show");

        // ëª¨ë“  ì„œë¸Œë©”ë‰´ ë‹«ê¸°
        allSubmenus.forEach(menu => {
            menu.classList.remove("show");
        });

        if (!isAlreadyVisible) {
            // ìœ„ì¹˜ ì¡°ì • (í´ë¦­í•œ ë²„íŠ¼ ê¸°ì¤€)
            const rect = element.getBoundingClientRect();
            submenu.style.top = `${rect.top}px`;

            // ì„œë¸Œ ë©”ë‰´ í‘œì‹œ
            submenu.classList.add("show");
        }
    }

    function loadPage(url) {
        document.getElementById("dynamicFrame").src = url;
    }
</script>
<!-- Bootstrap JS -->
<script src="/js/bootstrap/bootstrap.bundle.min.js"></script>
<script src="/js/loader.js"></script>
</body>
</html>